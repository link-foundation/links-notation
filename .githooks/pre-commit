#!/bin/bash
#
# Pre-commit hook to automatically regenerate TEST_CASE_COMPARISON.md
# when test files are modified.
#

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if any test files are being committed
test_files_changed=$(git diff --cached --name-only | grep -E 'tests?/.*\.(py|js|rs|cs)$')

if [ -n "$test_files_changed" ]; then
    echo -e "${YELLOW}Test files modified, regenerating TEST_CASE_COMPARISON.md...${NC}"

    # Run the comparison script
    if node scripts/create-test-case-comparison.mjs > /dev/null 2>&1; then
        # Check if TEST_CASE_COMPARISON.md was modified
        if git diff --name-only TEST_CASE_COMPARISON.md | grep -q "TEST_CASE_COMPARISON.md"; then
            echo -e "${GREEN}✓ TEST_CASE_COMPARISON.md regenerated${NC}"
            git add TEST_CASE_COMPARISON.md
            echo -e "${GREEN}✓ TEST_CASE_COMPARISON.md staged for commit${NC}"
        else
            echo -e "${GREEN}✓ TEST_CASE_COMPARISON.md is up-to-date${NC}"
        fi
    else
        echo -e "${RED}✗ Failed to regenerate TEST_CASE_COMPARISON.md${NC}"
        echo -e "${YELLOW}Please run: node scripts/create-test-case-comparison.mjs${NC}"
        exit 1
    fi
fi

# Run any other pre-commit checks here

exit 0
